# 交易查询功能

## 功能概述

在转账功能下新增了使用ethers.js查询交易信息的功能，支持输入交易地址来查询交易详情。

## 主要特性

### 1. 交易哈希验证
- 支持标准的以太坊交易哈希格式 (0x + 64位十六进制字符)
- 实时验证输入格式的有效性
- 提供清晰的错误提示

### 2. 完整的交易信息查询
- **基本信息**: 交易哈希、发送方、接收方、转账金额
- **交易状态**: 成功/失败状态，带颜色标识
- **区块信息**: 区块号、确认数、时间戳
- **Gas信息**: Gas价格、Gas限制
- **其他信息**: Nonce、交易数据(如果有)

### 3. 用户友好的界面
- 现代化的Uniswap风格UI设计
- 响应式布局，支持移动端
- 加载状态指示器
- 一键复制功能
- 清空查询结果功能

### 4. 错误处理
- 网络连接错误处理
- 交易不存在或未打包的处理
- 无效交易哈希格式的处理
- 友好的错误提示信息

## 技术实现

### 核心接口

```typescript
interface ITransactionData {
  hash: string
  from: string
  to: string
  value: string
  gasPrice: string
  gasLimit: string
  nonce: number
  data: string
  blockNumber: number
  blockHash: string
  timestamp: number
  confirmations: number | (() => Promise<number>)
  status: number
}
```

### 主要功能函数

#### 1. 交易查询函数
```typescript
const handleQueryTransaction = async () => {
  // 验证交易哈希格式
  // 获取交易收据
  // 获取交易详情
  // 获取区块信息
  // 格式化数据
  // 错误处理
}
```

#### 2. 复制到剪贴板
```typescript
const copyToClipboard = (text: string) => {
  navigator.clipboard.writeText(text)
  // 显示成功提示
}
```

#### 3. 清空查询结果
```typescript
const clearTransactionQuery = () => {
  setTransactionHash('')
  setTransactionData(null)
  setTransactionError('')
}
```

## 使用方法

### 1. 连接钱包
- 点击"连接 MetaMask"按钮
- 确保钱包已连接到正确的网络

### 2. 查询交易
- 切换到"转账功能"标签页
- 在"交易查询"区域输入交易哈希
- 点击"查询"按钮
- 查看详细的交易信息

### 3. 复制信息
- 点击任意信息项旁边的"复制"按钮
- 信息将自动复制到剪贴板

### 4. 清空结果
- 点击"清空"按钮清除当前查询结果

## 支持的交易类型

- 普通ETH转账
- 合约调用交易
- 代币转账交易
- 其他智能合约交互

## 网络支持

- 以太坊主网
- 测试网络 (Goerli, Sepolia)
- 其他兼容EVM的网络

## 错误代码说明

| 错误信息 | 原因 | 解决方案 |
|---------|------|----------|
| 无效的交易哈希格式 | 输入的交易哈希不符合0x+64位十六进制格式 | 检查交易哈希格式是否正确 |
| 交易不存在或尚未被打包 | 交易哈希无效或交易还在待处理状态 | 确认交易哈希正确，等待交易被打包 |
| 无法获取交易详情 | 网络连接问题或RPC节点问题 | 检查网络连接，尝试切换网络 |

## 测试用例

### 测试文件
- `test-transaction.html`: 独立的测试页面
- 包含完整的交易查询功能演示

### 示例交易哈希
```
0x88df016429689c079f3b2f6ad39fa052532c56795b733da78a91ebe6a713944b
```

## 性能优化

1. **防抖处理**: 输入框使用lodash防抖，减少不必要的状态更新
2. **异步处理**: 所有网络请求都是异步的，不会阻塞UI
3. **错误边界**: 完善的错误处理机制，确保应用稳定性
4. **内存管理**: 及时清理状态，避免内存泄漏

## 安全考虑

1. **输入验证**: 严格验证交易哈希格式
2. **网络安全**: 使用HTTPS连接
3. **数据完整性**: 验证从区块链获取的数据
4. **用户隐私**: 不存储用户查询历史

## 未来扩展

1. **批量查询**: 支持同时查询多个交易
2. **交易历史**: 显示地址的交易历史
3. **实时更新**: 支持实时更新交易状态
4. **导出功能**: 支持导出交易详情为PDF或CSV
5. **多语言支持**: 支持更多语言界面
